#!/bin/bash

# Get the package name from pubspec.yaml
PACKAGE_NAME=$(grep -m1 '^name:' pubspec.yaml | awk '{print $2}')

# Set the lib directory path
LIB_DIR="lib"

# Detect macOS or Linux for sed compatibility
if [[ "$OSTYPE" == "darwin"* ]]; then
    SED_CMD="sed -i ''"
else
    SED_CMD="sed -i"
fi

# Find all Dart files in the lib directory
find "$LIB_DIR" -type f -name "*.dart" | while read -r file; do
    # Use perl to detect and replace relative imports
    perl -pi -e "s@^(import|export)\s+['\"](\.\.?/[^'\"]+)['\"]@'\\1 \"package:$PACKAGE_NAME/' . substr(\$2, 3) . '\"'@e" "$file"

    echo "Updated: $file"
done

echo "Conversion completed."